<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.account.system.mapper.ReceiptMapper">

    <update id="updateReceipt">
        update sys_receipt
        set chip          = chip + #{chip},
            cash          = cash + #{cash},
            insurance     = insurance + #{insurance},
            win           = win - #{cash},
            insurance_win = insurance_win - #{insurance},
            water         = water + #{water},
            update_time   = sysdate()
        where id = #{id}
    </update>

    <select id="selectReceiptList" resultType="com.account.system.domain.SysReceipt">
        SELECT
        r.table_id as tableId,
        r.chip as chip,
        r.cash as cash,
        r.insurance as insurance,
        r.chip_add as chipAdd,
        r.cash_add as cashAdd,
        r.insurance_add as insuranceAdd,
        r.water as water,
        r.win as win,
        r.insurance_win as insuranceWin,
        r.create_time as createTime,
        r.remark as remark
        FROM
        sys_receipt r
        LEFT JOIN	 sys_table_management t  ON t.table_id = r.table_id  and t.is_delete = 0
    <where>
        <if test="tableId != null and tableId != ''">
            AND r.table_id = #{tableId}
        </if>

        <if test="gameId != null and gameId != ''">
            AND t.game_id = #{gameId}
        </if>
        <if test="startTime != null and startTime != ''">
            AND r.create_time <![CDATA[>=]]> #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            AND r.create_time <![CDATA[<=]]> #{endTime}
        </if>
    </where>
        GROUP BY r.table_id
        ORDER BY r.create_time deac
    </select>
</mapper>
