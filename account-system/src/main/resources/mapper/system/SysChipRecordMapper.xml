<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.account.system.mapper.SysChipRecordMapper">

    <insert id="addChipRecord">

        INSERT INTO sys_chip_record
        (
        <if test="card != null and card != ''">card,</if>
        <if test="type != null and type != ''">type,</if>
        <if test="before != null">`before`,</if>
        <if test="change != null"> `change`,</if>
        <if test="after != null ">`after`,</if>
        <if test="beforeTh != null">before_th,</if>
        <if test="changeTh != null">change_th,</if>
        <if test="afterTh != null ">after_th,</if>
        <if test="betId != null and betId != ''">bet_id,</if>
        <if test="createBy != null and createBy != ''">create_by,</if>
        create_time )
        values(
        <if test="card != null and card != ''">#{card},</if>
        <if test="type != null and type != ''">#{type},</if>
        <if test="before != null ">#{before},</if>
        <if test="change != null">#{change},</if>
        <if test="after != null ">#{after},</if>
        <if test="beforeTh != null ">#{beforeTh},</if>
        <if test="changeTh != null ">#{changeTh},</if>
        <if test="afterTh != null ">#{afterTh},</if>
        <if test="betId != null and betId != ''">#{betId},</if>
        <if test="createBy != null and createBy != ''">#{createBy},</if>
        sysdate()
        )
    </insert>


    <insert id="addChipRecordList">
        <foreach item="item" index="index" collection="list" separator=";">
        insert into sys_chip_record (card,type,`before`,`change`,`after`,create_by,create_time)
        values (#{item.card},#{item.type},#{item.before},#{item.change},#{item.after},#{item.createBy},sysdate())
        </foreach>
    </insert>


    <select id="selectChipRecordList"  resultType="java.util.Map">
        SELECT
        c.card,
        m.`name` AS NAME,
        c.type,
        c.`before`,
        c.`change`,
        c.`after`,
        c.`before_th` as beforeTh,
        c.`change_th` as changeTh,
        c.`after_th` as afterTh,
        c.create_time AS createTime,
        c.create_by AS createBy
        FROM
        sys_chip_record c
        LEFT JOIN sys_members m ON m.card = c.card
        <where>
            <if test="isAdmin != null and isAdmin != '' and isAdmin > 0">
                AND m.is_admin = 0
            </if>
            <if test="card != null and card != ''">
                AND m.card = #{card}
            </if>

            <if test="type != null and type != ''">
                AND c.type = #{type}
            </if>
            <if test="startTime != null and startTime != ''">
                AND c.create_time <![CDATA[>=]]> #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                AND c.create_time <![CDATA[<=]]> #{endTime}
            </if>
        </where>
        ORDER BY c.create_time DESC
    </select>

    <select id="selectChipRecord"  resultType="SysChipRecord">
        SELECT card,
               type,
               `before`,
               `change`,
               `after`,
               bet_id betId
        FROM sys_chip_record
        where card = #{card}
          and bet_id = #{betId}
        limit 0,1
    </select>

    <update id="updateChipRecord">
        update sys_chip_record
        set `change` = #{change},
            `after` = #{after},
            `change_th` = #{changeTh},
            `after_th` = #{afterTH},
            `type` = #{type}
        where card = #{card} and bet_id = #{betId}
    </update>

    <delete id="deleteChipRecord">
        delete from sys_chip_record where card = #{card} and bet_id = #{betId}
    </delete>
</mapper>
